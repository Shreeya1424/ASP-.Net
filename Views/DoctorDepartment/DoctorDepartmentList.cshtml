@using System.Data
@model System.Data.DataTable;

@{
	ViewBag.Title = "DoctorDepartment List";
}
<form asp-action="DeleteSelectedDoctorDepartments" asp-controller="Users" method="post">
    @Html.AntiForgeryToken()
<div class="card">
	<div class="card-body">
		<h5 class="card-title">DoctorDepartment List</h5>
		<p>Displays organized records in a clear format, allowing users to view essential details at a glance. Helps in tracking, reviewing, and managing information efficiently across various sections.</p>
		<div style="text-align: right; margin-bottom: 15px;">
			<a class="btn btn-primary" asp-controller="DoctorDepartment" asp-action="DoctorDepartmentEdit">
				<i class="bi bi-person-plus me-1"></i> Add New

			</a>
			<a asp-action="ExportToExcel" class="btn btn-success">
				<i class="bi bi-file-earmark-excel"></i> Export to Excel
			</a>
				<button type="submit" class="btn btn-danger">
					<i class="bi ri-delete-bin-2-fill"></i> Delete Selected
				</button>
		</div>
		<div class="table-responsive" style="max-height: 400px; overflow: auto;">
			<table class="table  table-striped mb-0">
						<thead>
							<tr>
							<th><input type="checkbox" id="selectAll" /></th>

								<th>DoctorDepartmentID</th>
								<th>DoctorID</th>
								<th>DepartmentID</th>
								@* <th>Created</th>
								<th>Modified</th> *@
								<th>UserID</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
						@foreach (DataRow dataRow in Model.Rows)
						{
							<tr>
								<td>
									<input type="checkbox" name="selectedUserIds" value="@dataRow["DoctorDepartmentID"]" class="doctordepartmentCheckbox" />
								</td>
								<td>@dataRow["DoctorDepartmentID"]</td>
								<td>@dataRow["DoctorName"]</td>
								<td>@dataRow["DepartmentName"]</td>
								<td>@dataRow["CreatedByUser"]</td>

								<td>
							
									<div class="d-inline-flex gap-1">
									<a asp-controller="DoctorDepartment"
									   asp-action="DoctorDepartmentEdit"
									   asp-route-DoctorDepartmentID="@dataRow["DoctorDepartmentID"]"
									   class="btn btn-sm btn-primary me-1"
									   title="Edit">
										<i class="bi bi-pencil-square"></i>
									</a>
									<a href="javascript:void(0);"
									   class="btn btn-sm btn-danger delete-btn d-flex align-items-center justify-content-center"
									   data-doctordepartmentId="@dataRow["DoctorDepartmentID"]"
									   title="Delete"
									   style="width:32px; height:32px; padding:0;">
										<span class="d-inline-block bg-white rounded-circle d-flex align-items-center justify-content-center"
											  style="width:18px; height:18px;">
											<i class="bi bi-x text-danger" style="font-size:12px;"></i>
										</span>
									</a>
								</div>
							</td>
								</tr>
							}

						</tbody>
					</table>
				</div>
			</div>

		</div>
</form>
@section Scripts {
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script>

		document.getElementById("selectAll").addEventListener("change", function () {
			const checkboxes = document.querySelectorAll(".doctordepartmentCheckbox");
			checkboxes.forEach(cb => cb.checked = this.checked);
		});

		document.addEventListener('DOMContentLoaded', function () {
			const deleteButtons = document.querySelectorAll('.delete-btn');

			deleteButtons.forEach(btn => {
				btn.addEventListener('click', function () {
					const doctordepartmentId = this.getAttribute('data-doctordepartmentid');

					Swal.fire({
						title: 'Are you sure?',
						text: 'You won\'t be able to revert this!',
						icon: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Yes, delete it!',
						cancelButtonText: 'No'
					}).then((result) => {
						if (result.isConfirmed) {
							// Redirect to delete action
							window.location.href = '/DoctorDepartment/DeleteDoctorDepartment?DoctorDepartmentID=' + doctordepartmentId;
						}
					});
				});
			});

			 @if (TempData["SuccessMessage"] != null)
			{
						<text>
							Swal.fire({
								icon: 'success',
								title: 'Success!',
								text: '@TempData["SuccessMessage"]',
								timer: 2000,
								showConfirmButton: false
							});
						</text>
			}

			@if (TempData["UpdateSuccessMessage"] != null)
			{
							<text>
								Swal.fire({
									icon: 'success',
									title: 'Success!',
										text: '@TempData["UpdateSuccessMessage"]',
									timer: 2000,
									showConfirmButton: false
								});
							</text>
			}

			@* Success popup after delete *@
			@if (TempData["DeleteSuccessMessage"] != null)
			{
						<text>
							Swal.fire({
								icon: 'success',
								title: 'Deleted!',
								text: '@TempData["DeleteSuccessMessage"]',
								showConfirmButton: false,
								timer: 2000
							});
						</text>
			}
		});
			document.addEventListener('DOMContentLoaded', function () {
			const deleteButtons = document.querySelectorAll('.delete-btn');

			deleteButtons.forEach(btn => {
				btn.addEventListener('click', function () {
					const doctordepartmentId = this.getAttribute('data-doctordepartmentid');

					Swal.fire({
						title: 'Are you sure?',
						text: 'Do you really want to delete this user?',
						icon: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#d33',
						cancelButtonColor: '#3085d6',
						confirmButtonText: 'Yes, delete it!',
						cancelButtonText: 'Cancel'
					}).then((result) => {
						if (result.isConfirmed) {
							// Now make the delete request
							$.ajax({
								url: '/DoctorDepartment/DeleteDoctorDepartment',
								type: 'POST',
								data: { DoctorDepartmentID: doctordepartmentId },
								success: function () {
									Swal.fire({
										icon: 'success',
										title: 'Deleted!',
										text: 'User deleted successfully.',
										timer: 2000,
										showConfirmButton: false
									}).then(() => {
										location.reload(); // Reload the page
									});
								},
								error: function () {
									Swal.fire({
										icon: 'error',
										title: 'Error!',
										text: 'There was a problem deleting the user.'
									});
								}
							});
						}
					});
				});
			});

			// Optional: Display success message from TempData (after redirect)
			@if (TempData["DeleteSuccessMessage"] != null)
			{
						<text>
							Swal.fire({
								icon: 'success',
								title: 'Deleted!',
								text: '@TempData["DeleteSuccessMessage"]',
								timer: 2000,
								showConfirmButton: false
							});
						</text>
			}
		});
	</script>
}
